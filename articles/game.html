<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beer Distribution Game</title>
    <style>
        /* Your existing CSS remains the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #87CEEB, #98FB98, #F0E68C);
            min-height: 100vh;
            overflow-x: auto;
        }

        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ... (all your existing CSS remains exactly the same) ... */

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
    </style>
</head>
<body>
    <div class="tutorial-overlay" id="tutorialOverlay">
        <div class="tutorial-content">
            <h2 class="tutorial-title">üç∫ Welcome to the Beer Distribution Game!</h2>
            <p class="tutorial-text">
                You're about to experience the famous supply chain simulation! 
                Each player manages a different stage: Retailer, Wholesaler, Distributor, and Factory.
                <br><br>
                <strong>Your goal:</strong> Meet customer demand while minimizing inventory and backlog costs.
                <br><br>
                <strong>Watch out for the Bullwhip Effect!</strong> Small changes in demand can create huge swings upstream.
            </p>
            <button class="start-game-btn" onclick="startGame()">üéÆ Start Playing!</button>
        </div>
    </div>

    <div class="game-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="week-display">Week <span id="currentWeek">1</span></div>
            <div class="demand-display">
                <div class="dice" id="demandDice">4</div>
                <span>Customer Demand</span>
            </div>
            <div class="cost-display">
                Total Cost: $<span id="totalCost">0</span>
            </div>
        </div>

        <!-- Game Board -->
        <div class="game-board">
            <h2 class="board-title">üç∫ Beer Distribution Chain</h2>
            <div class="stages-container">
                <!-- Retailer -->
                <div class="stage-card retailer" data-stage="retailer">
                    <div class="stage-header">
                        <h3 class="stage-title">RETAILER</h3>
                        <div class="avatar">üè™</div>
                    </div>
                    <div class="tokens-container">
                        <div class="token-row">
                            <div class="token-icon inventory-token">üì¶</div>
                            <span>Inventory:</span>
                            <span class="token-count" id="retailer-inventory">12</span>
                        </div>
                        <div class="token-row">
                            <div class="token-icon backlog-token">‚ö†Ô∏è</div>
                            <span>Backlog:</span>
                            <span class="token-count" id="retailer-backlog">0</span>
                        </div>
                        <div class="token-row">
                            <div class="token-icon shipment-token">üöö</div>
                            <span>Incoming:</span>
                            <span class="token-count" id="retailer-incoming">0</span>
                        </div>
                    </div>
                </div>

                <!-- Arrow 1 -->
                <div class="arrow arrow-1">‚û§</div>

                <!-- Wholesaler -->
                <div class="stage-card wholesaler" data-stage="wholesaler">
                    <div class="stage-header">
                        <h3 class="stage-title">WHOLESALER</h3>
                        <div class="avatar">üè≠</div>
                    </div>
                    <div class="tokens-container">
                        <div class="token-row">
                            <div class="token-icon inventory-token">üì¶</div>
                            <span>Inventory:</span>
                            <span class="token-count" id="wholesaler-inventory">12</span>
                        </div>
                        <div class="token-row">
                            <div class="token-icon backlog-token">‚ö†Ô∏è</div>
                            <span>Backlog:</span>
                            <span class="token-count" id="wholesaler-backlog">0</span>
                        </div>
                        <div class="token-row">
                            <div class="token-icon shipment-token">üöö</div>
                            <span>Incoming:</span>
                            <span class="token-count" id="wholesaler-incoming">0</span>
                        </div>
                    </div>
                </div>

                <!-- Arrow 2 -->
                <div class="arrow arrow-2">‚û§</div>

                <!-- Distributor -->
                <div class="stage-card distributor" data-stage="distributor">
                    <div class="stage-header">
                        <h3 class="stage-title">DISTRIBUTOR</h3>
                        <div class="avatar">üöõ</div>
                    </div>
                    <div class="tokens-container">
                        <div class="token-row">
                            <div class="token-icon inventory-token">üì¶</div>
                            <span>Inventory:</span>
                            <span class="token-count" id="distributor-inventory">12</span>
                        </div>
                        <div class="token-row">
                            <div class="token-icon backlog-token">‚ö†Ô∏è</div>
                            <span>Backlog:</span>
                            <span class="token-count" id="distributor-backlog">0</span>
                        </div>
                        <div class="token-row">
                            <div class="token-icon shipment-token">üöö</div>
                            <span>Incoming:</span>
                            <span class="token-count" id="distributor-incoming">0</span>
                        </div>
                    </div>
                </div>

                <!-- Arrow 3 -->
                <div class="arrow arrow-3">‚û§</div>

                <!-- Factory -->
                <div class="stage-card factory" data-stage="factory">
                    <div class="stage-header">
                        <h3 class="stage-title">FACTORY</h3>
                        <div class="avatar">üè≠</div>
                    </div>
                    <div class="tokens-container">
                        <div class="token-row">
                            <div class="token-icon inventory-token">üì¶</div>
                            <span>Inventory:</span>
                            <span class="token-count" id="factory-inventory">12</span>
                        </div>
                        <div class="token-row">
                            <div class="token-icon backlog-token">‚ö†Ô∏è</div>
                            <span>Backlog:</span>
                            <span class="token-count" id="factory-backlog">0</span>
                        </div>
                        <div class="token-row">
                            <div class="token-icon shipment-token">üöö</div>
                            <span>Production:</span>
                            <span class="token-count" id="factory-production">0</span>
                        </div>
                    </div>
                </div>

                <!-- Moving truck animation -->
                <div class="truck" id="movingTruck">üöö</div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <h3 class="control-title">üéÆ Place Your Order</h3>
            <div class="order-controls">
                <div class="order-slider-container">
                    <label style="color: white; font-weight: bold;">Order Quantity:</label>
                    <input type="range" class="order-slider" id="orderSlider" min="0" max="20" value="4">
                    <div class="order-value" id="orderValue">4 units</div>
                </div>
                <button class="place-order-btn" id="placeOrderBtn">
                    üéØ Place Order
                </button>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <h3 class="sidebar-title">üìä Scoreboard</h3>
        <div class="score-item retailer">
            <span>Retailer Cost:</span>
            <span id="retailer-cost">$0</span>
        </div>
        <div class="score-item wholesaler">
            <span>Wholesaler Cost:</span>
            <span id="wholesaler-cost">$0</span>
        </div>
        <div class="score-item distributor">
            <span>Distributor Cost:</span>
            <span id="distributor-cost">$0</span>
        </div>
        <div class="score-item factory">
            <span>Factory Cost:</span>
            <span id="factory-cost">$0</span>
        </div>
        <button class="charts-btn" id="chartsBtn">
            üìà View Charts
        </button>
    </div>

    <!-- Charts Modal -->
    <div class="modal" id="chartsModal">
        <div class="modal-content">
            <button class="close-btn" id="closeChartsBtn">&times;</button>
            <h2 style="text-align: center; margin-bottom: 30px; color: #8B4513;">üìà Game Analytics</h2>
            <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px;">
                <h3 style="color: #333; margin-bottom: 20px;">The Bullwhip Effect in Action!</h3>
                <p style="font-size: 16px; line-height: 1.6; color: #666;">
                    This chart would show how small demand changes create larger order variations upstream.
                    <br><br>
                    <strong>Week 1-3:</strong> Steady demand of 4 units<br>
                    <strong>Week 4-8:</strong> Increased demand creates amplified orders<br>
                    <strong>Week 9+:</strong> Return to normal, but with overshooting
                </p>
                <div style="margin: 30px 0; padding: 20px; background: white; border-radius: 10px; border: 2px solid #ddd;">
                    üìä Interactive charts would be implemented here using Chart.js or D3.js
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameData = {
            week: 1,
            demand: 4,
            totalCost: 0,
            stages: {
                retailer: { inventory: 12, backlog: 0, incoming: 0, cost: 0 },
                wholesaler: { inventory: 12, backlog: 0, incoming: 0, cost: 0 },
                distributor: { inventory: 12, backlog: 0, incoming: 0, cost: 0 },
                factory: { inventory: 12, backlog: 0, production: 0, cost: 0 }
            },
            orders: [] // Track order history
        };

        // Initialize game
        function startGame() {
            document.getElementById('tutorialOverlay').style.display = 'none';
            updateDisplay();
        }

        // Order slider functionality
        const orderSlider = document.getElementById('orderSlider');
        const orderValue = document.getElementById('orderValue');

        orderSlider.addEventListener('input', function() {
            orderValue.textContent = this.value + ' units';
        });

        // Enhanced place order function
        function placeOrder() {
            const orderQuantity = parseInt(orderSlider.value);
            
            // Store the order
            gameData.orders.push({
                week: gameData.week,
                quantity: orderQuantity,
                stage: 'retailer' // Player always plays as retailer
            });
            
            // Animate truck movement
            animateTruck();
            
            // Update game state
            simulateWeek(orderQuantity);
            
            // Update display
            updateDisplay();
            
            // Show feedback
            showOrderFeedback(orderQuantity);
            
            // Add stage highlighting
            highlightRandomStage();
            
            // Check for game end
            checkGameEnd();
        }

        function simulateWeek(orderQuantity) {
            // Increment week
            gameData.week++;
            
            // Generate new demand pattern
            const demands = [4, 4, 4, 8, 8, 6, 4, 4, 4, 4, 4, 4];
            gameData.demand = demands[Math.min(gameData.week - 1, demands.length - 1)] || 4;
            
            // Process supply chain flow
            processSupplyChain(orderQuantity);
            
            // Calculate costs
            calculateCosts();
        }

        function processSupplyChain(orderQuantity) {
            // Simplified supply chain simulation
            const stages = ['factory', 'distributor', 'wholesaler', 'retailer'];
            
            // Process from factory to retailer (upstream to downstream)
            for (let i = 0; i < stages.length - 1; i++) {
                const currentStage = stages[i];
                const nextStage = stages[i + 1];
                
                // Move inventory downstream
                const availableInventory = gameData.stages[currentStage].inventory;
                const incomingOrder = (nextStage === 'retailer') ? orderQuantity : 
                                    gameData.stages[nextStage].incoming;
                
                const canShip = Math.min(availableInventory, incomingOrder);
                
                // Update inventories
                gameData.stages[currentStage].inventory -= canShip;
                gameData.stages[nextStage].incoming = canShip;
                
                // Handle backlogs
                if (canShip < incomingOrder) {
                    gameData.stages[nextStage].backlog += (incomingOrder - canShip);
                }
            }
            
            // Retailer handles customer demand
            const retailer = gameData.stages.retailer;
            const availableForSale = retailer.inventory + retailer.incoming;
            
            if (availableForSale >= gameData.demand) {
                // Meet demand
                retailer.inventory = availableForSale - gameData.demand;
                retailer.backlog = 0;
            } else {
                // Can't meet demand - create backlog
                retailer.inventory = 0;
                retailer.backlog = gameData.demand - availableForSale;
            }
            
            // Clear incoming shipments (they've been processed)
            retailer.incoming = 0;
            gameData.stages.wholesaler.incoming = 0;
            gameData.stages.distributor.incoming = 0;
            
            // Factory produces based on orders
            gameData.stages.factory.production = Math.max(4, orderQuantity + 2); // Simple production rule
            gameData.stages.factory.inventory += gameData.stages.factory.production;
        }

        function calculateCosts() {
            // Reset total cost
            gameData.totalCost = 0;
            
            // Calculate costs for each stage
            Object.keys(gameData.stages).forEach(stage => {
                const stageData = gameData.stages[stage];
                // Holding cost: $0.5 per unit in inventory
                // Backlog cost: $1.0 per unit in backlog
                const stageCost = (stageData.inventory * 0.5) + (stageData.backlog * 1.0);
                stageData.cost += stageCost;
                gameData.totalCost += stageCost;
            });
        }

        function updateDisplay() {
            // Update week
            document.getElementById('currentWeek').textContent = gameData.week;
            
            // Update demand dice
            document.getElementById('demandDice').textContent = gameData.demand;
            
            // Update total cost
            document.getElementById('totalCost').textContent = Math.round(gameData.totalCost);
            
            // Update stage displays
            Object.keys(gameData.stages).forEach(stage => {
                const stageData = gameData.stages[stage];
                document.getElementById(`${stage}-inventory`).textContent = Math.max(0, stageData.inventory);
                document.getElementById(`${stage}-backlog`).textContent = Math.max(0, stageData.backlog);
                
                if (stage === 'factory') {
                    document.getElementById(`${stage}-production`).textContent = stageData.production || 0;
                } else {
                    document.getElementById(`${stage}-incoming`).textContent = stageData.incoming || 0;
                }
                
                document.getElementById(`${stage}-cost`).textContent = '$' + Math.round(stageData.cost);
            });
        }

        function animateTruck() {
            const truck = document.getElementById('movingTruck');
            truck.style.animation = 'none';
            setTimeout(() => {
                truck.style.animation = 'moveTruck 3s linear';
            }, 10);
        }

        function showOrderFeedback(quantity) {
            // Create a temporary feedback element
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, #32CD32, #228B22);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                font-size: 18px;
                font-weight: bold;
                z-index: 1500;
                border: 3px solid #8B4513;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            `;
            feedback.textContent = `‚úÖ Order placed: ${quantity} units`;
            document.body.appendChild(feedback);
            
            // Animate feedback
            feedback.animate([
                { opacity: 0, transform: 'translate(-50%, -50%) scale(0.5)' },
                { opacity: 1, transform: 'translate(-50%, -50%) scale(1.1)' },
                { opacity: 1, transform: 'translate(-50%, -50%) scale(1)' },
                { opacity: 0, transform: 'translate(-50%, -50%) scale(1)' }
            ], {
                duration: 2000,
                easing: 'ease-out'
            });
            
            // Remove after animation
            setTimeout(() => {
                if (feedback.parentNode) {
                    feedback.parentNode.removeChild(feedback);
                }
            }, 2000);
        }

        function highlightRandomStage() {
            document.querySelectorAll('.stage-card').forEach(card => {
                card.classList.remove('active');
            });
            
            const stages = ['retailer', 'wholesaler', 'distributor', 'factory'];
            const randomStage = stages[Math.floor(Math.random() * stages.length)];
            const stageElement = document.querySelector(`[data-stage="${randomStage}"]`);
            
            if (stageElement) {
                stageElement.classList.add('active');
                setTimeout(() => {
                    stageElement.classList.remove('active');
                }, 2000);
            }
        }

        function checkGameEnd() {
            if (gameData.week >= 12) {
                setTimeout(showEndGameCelebration, 1000);
            }
        }

        function showEndGameCelebration() {
            // Create confetti
            for (let i = 0; i < 50; i++) {
                setTimeout(() => createConfetti(), i * 100);
            }
            
            // Show end game modal
            const endModal = document.createElement('div');
            endModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 3000;
            `;
            
            endModal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; text-align: center; border: 4px solid #8B4513;">
                    <h1 style="font-size: 32px; color: #8B4513; margin-bottom: 20px;">üéâ Game Complete!</h1>
                    <h2 style="color: #FF4444; margin-bottom: 15px;">You experienced the Bullwhip Effect!</h2>
                    <p style="font-size: 18px; margin-bottom: 25px; color: #333;">
                        Total Supply Chain Cost: <strong>$${Math.round(gameData.totalCost)}</strong>
                    </p>
                    <p style="font-size: 16px; margin-bottom: 30px; color: #666; line-height: 1.6;">
                        Small changes in customer demand created larger fluctuations upstream in the supply chain.
                        This is the famous "Bullwhip Effect" that costs companies billions annually!
                    </p>
                    <button id="playAgainBtn" style="
                        background: linear-gradient(45deg, #32CD32, #228B22);
                        color: white;
                        border: none;
                        padding: 15px 30px;
                        font-size: 18px;
                        font-weight: bold;
                        border-radius: 10px;
                        cursor: pointer;
                        border: 3px solid #8B4513;
                    ">üîÑ Play Again</button>
                </div>
            `;
            
            document.body.appendChild(endModal);
            
            // Add event listener for play again button
            document.getElementById('playAgainBtn').addEventListener('click', function() {
                location.reload();
            });
        }

        function createConfetti() {
            const confetti = document.createElement('div');
            const colors = ['#FFD700', '#FF4444', '#32CD32', '#4169E1', '#FF69B4'];
            const shapes = ['üéâ', 'üéä', '‚≠ê', 'üåü', '‚ú®'];
            
            confetti.className = 'confetti';
            confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.fontSize = (Math.random() * 20 + 15) + 'px';
            confetti.style.animationDelay = Math.random() * 2 + 's';
            confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
            
            document.body.appendChild(confetti);
            
            setTimeout(() => {
                if (confetti.parentNode) {
                    confetti.parentNode.removeChild(confetti);
                }
            }, 5000);
        }

        // Event listeners
        document.getElementById('placeOrderBtn').addEventListener('click', placeOrder);
        document.getElementById('chartsBtn').addEventListener('click', showCharts);
        document.getElementById('closeChartsBtn').addEventListener('click', closeCharts);

        function showCharts() {
            document.getElementById('chartsModal').style.display = 'block';
        }

        function closeCharts() {
            document.getElementById('chartsModal').style.display = 'none';
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                placeOrder();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                orderSlider.value = Math.max(0, parseInt(orderSlider.value) - 1);
                orderValue.textContent = orderSlider.value + ' units';
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                orderSlider.value = Math.min(20, parseInt(orderSlider.value) + 1);
                orderValue.textContent = orderSlider.value + ' units';
            }
        });

        // Close modal when clicking outside
        document.getElementById('chartsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCharts();
            }
        });

        // Initialize display on load
        window.addEventListener('load', function() {
            updateDisplay();
        });

        // Stage card hover effects with tooltips
        document.querySelectorAll('.stage-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                const stage = this.dataset.stage;
                showTooltip(this, stage);
            });
            
            card.addEventListener('mouseleave', function() {
                hideTooltip();
            });
        });

        function showTooltip(element, stage) {
            // Remove existing tooltip
            hideTooltip();
            
            const tooltip = document.createElement('div');
            tooltip.id = 'stageTooltip';
            tooltip.style.cssText = `
                position: absolute;
                top: -10px;
                left: 50%;
                transform: translateX(-50%);
                background: #333;
                color: white;
                padding: 10px 15px;
                border-radius: 8px;
                font-size: 14px;
                white-space: nowrap;
                z-index: 1000;
                box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                pointer-events: none;
            `;
            
            const tooltips = {
                retailer: "üè™ Sells directly to customers. Manages shelf inventory.",
                wholesaler: "üè≠ Buys in bulk from distributors. Supplies retailers.",
                distributor: "üöõ Transports goods from factory to wholesalers.",
                factory: "üè≠ Produces the beer. Takes time to ramp up production."
            };
            
            tooltip.textContent = tooltips[stage];
            element.style.position = 'relative';
            element.appendChild(tooltip);
        }

        function hideTooltip() {
            const tooltip = document.getElementById('stageTooltip');
            if (tooltip) {
                tooltip.remove();
            }
        }

        // Add background elements
        function addBackgroundElements() {
            const elements = ['üç∫', 'üì¶', 'üöö', '‚ö°'];
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const bg = document.createElement('div');
                    bg.style.cssText = `
                        position: fixed;
                        top: ${Math.random() * 100}vh;
                        left: ${Math.random() * 100}vw;
                        font-size: 24px;
                        opacity: 0.1;
                        z-index: -1;
                        pointer-events: none;
                        animation: float 6s ease-in-out infinite;
                    `;
                    bg.textContent = elements[Math.floor(Math.random() * elements.length)];
                    document.body.appendChild(bg);
                    
                    setTimeout(() => {
                        if (bg.parentNode) bg.parentNode.removeChild(bg);
                    }, 10000);
                }, i * 1000);
            }
        }

        // Start background animation
        addBackgroundElements();
        setInterval(addBackgroundElements, 15000);
    </script>
</body>
</html>
